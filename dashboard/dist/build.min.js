import{toChildArray as e,cloneElement as t,Component as n,createElement as i}from"https://unpkg.com/preact@>=10?module";var r,o,l,s,a={},u=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function p(e,t){for(var n in t)e[n]=t[n];return e}function d(e){var t=e.parentNode;t&&t.removeChild(e)}function f(e,t,n){var i,r,o,l=arguments,s={};for(o in t)"key"==o?i=t[o]:"ref"==o?r=t[o]:s[o]=t[o];if(arguments.length>3)for(n=[n],o=3;o<arguments.length;o++)n.push(l[o]);if(null!=n&&(s.children=n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===s[o]&&(s[o]=e.defaultProps[o]);return _(e,s,i,r,null)}function _(e,t,n,i,o){var l={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++r.__v:o};return null!=r.vnode&&r.vnode(l),l}function h(e){return e.children}function m(e,t){this.props=e,this.context=t}function g(e,t){if(null==t)return e.__?g(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?g(e):null}function v(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return v(e)}}function y(e){(!e.__d&&(e.__d=!0)&&o.push(e)&&!b.__r++||s!==r.debounceRendering)&&((s=r.debounceRendering)||l)(b)}function b(){for(var e;b.__r=o.length;)e=o.sort((function(e,t){return e.__v.__b-t.__v.__b})),o=[],e.some((function(e){var t,n,i,r,o,l;e.__d&&(o=(r=(t=e).__v).__e,(l=t.__P)&&(n=[],(i=p({},r)).__v=r.__v+1,j(l,r,i,t.__n,void 0!==l.ownerSVGElement,null!=r.__h?[o]:null,n,null==o?g(r):o,r.__h),$(n,r),r.__e!=o&&v(r)))}))}function k(e,t,n,i,r,o,l,s,c,p){var d,f,m,v,y,b,k,S=i&&i.__k||u,T=S.length;for(n.__k=[],d=0;d<t.length;d++)if(null!=(v=n.__k[d]=null==(v=t[d])||"boolean"==typeof v?null:"string"==typeof v||"number"==typeof v||"bigint"==typeof v?_(null,v,null,null,v):Array.isArray(v)?_(h,{children:v},null,null,null):v.__b>0?_(v.type,v.props,v.key,null,v.__v):v)){if(v.__=n,v.__b=n.__b+1,null===(m=S[d])||m&&v.key==m.key&&v.type===m.type)S[d]=void 0;else for(f=0;f<T;f++){if((m=S[f])&&v.key==m.key&&v.type===m.type){S[f]=void 0;break}m=null}j(e,v,m=m||a,r,o,l,s,c,p),y=v.__e,(f=v.ref)&&m.ref!=f&&(k||(k=[]),m.ref&&k.push(m.ref,null,v),k.push(f,v.__c||y,v)),null!=y?(null==b&&(b=y),"function"==typeof v.type&&null!=v.__k&&v.__k===m.__k?v.__d=c=w(v,c,e):c=C(e,v,m,S,y,c),p||"option"!==n.type?"function"==typeof n.type&&(n.__d=c):e.value=""):c&&m.__e==c&&c.parentNode!=e&&(c=g(m))}for(n.__e=b,d=T;d--;)null!=S[d]&&("function"==typeof n.type&&null!=S[d].__e&&S[d].__e==n.__d&&(n.__d=g(i,d+1)),R(S[d],S[d]));if(k)for(d=0;d<k.length;d++)U(k[d],k[++d],k[++d])}function w(e,t,n){var i,r;for(i=0;i<e.__k.length;i++)(r=e.__k[i])&&(r.__=e,t="function"==typeof r.type?w(r,t,n):C(n,r,r,e.__k,r.__e,t));return t}function C(e,t,n,i,r,o){var l,s,a;if(void 0!==t.__d)l=t.__d,t.__d=void 0;else if(null==n||r!=o||null==r.parentNode)e:if(null==o||o.parentNode!==e)e.appendChild(r),l=null;else{for(s=o,a=0;(s=s.nextSibling)&&a<i.length;a+=2)if(s==r)break e;e.insertBefore(r,o),l=o}return void 0!==l?l:r.nextSibling}function S(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||c.test(t)?n:n+"px"}function T(e,t,n,i,r){var o;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||S(e.style,t,"");if(n)for(t in n)i&&n[t]===i[t]||S(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])o=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i||e.addEventListener(t,o?D:O,o):e.removeEventListener(t,o?D:O,o);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function O(e){this.l[e.type+!1](r.event?r.event(e):e)}function D(e){this.l[e.type+!0](r.event?r.event(e):e)}function j(e,t,n,i,o,l,s,a,u){var c,d,f,_,g,v,y,b,w,C,S,T=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(u=n.__h,a=t.__e=n.__e,t.__h=null,l=[a]),(c=r.__b)&&c(t);try{e:if("function"==typeof T){if(b=t.props,w=(c=T.contextType)&&i[c.__c],C=c?w?w.props.value:c.__:i,n.__c?y=(d=t.__c=n.__c).__=d.__E:("prototype"in T&&T.prototype.render?t.__c=d=new T(b,C):(t.__c=d=new m(b,C),d.constructor=T,d.render=P),w&&w.sub(d),d.props=b,d.state||(d.state={}),d.context=C,d.__n=i,f=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=T.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=p({},d.__s)),p(d.__s,T.getDerivedStateFromProps(b,d.__s))),_=d.props,g=d.state,f)null==T.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==T.getDerivedStateFromProps&&b!==_&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(b,C),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(b,d.__s,C)||t.__v===n.__v){d.props=b,d.state=d.__s,t.__v!==n.__v&&(d.__d=!1),d.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),d.__h.length&&s.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(b,d.__s,C),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(_,g,v)}))}d.context=C,d.props=b,d.state=d.__s,(c=r.__r)&&c(t),d.__d=!1,d.__v=t,d.__P=e,c=d.render(d.props,d.state,d.context),d.state=d.__s,null!=d.getChildContext&&(i=p(p({},i),d.getChildContext())),f||null==d.getSnapshotBeforeUpdate||(v=d.getSnapshotBeforeUpdate(_,g)),S=null!=c&&c.type===h&&null==c.key?c.props.children:c,k(e,Array.isArray(S)?S:[S],t,n,i,o,l,s,a,u),d.base=t.__e,t.__h=null,d.__h.length&&s.push(d),y&&(d.__E=d.__=null),d.__e=!1}else null==l&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=x(n.__e,t,n,i,o,l,s,u);(c=r.diffed)&&c(t)}catch(e){t.__v=null,(u||null!=l)&&(t.__e=a,t.__h=!!u,l[l.indexOf(a)]=null),r.__e(e,t,n)}}function $(e,t){r.__c&&r.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){r.__e(e,t.__v)}}))}function x(e,t,n,i,r,o,l,s){var c,p,f,_,h=n.props,m=t.props,g=t.type,v=0;if("svg"===g&&(r=!0),null!=o)for(;v<o.length;v++)if((c=o[v])&&(c===e||(g?c.localName==g:3==c.nodeType))){e=c,o[v]=null;break}if(null==e){if(null===g)return document.createTextNode(m);e=r?document.createElementNS("http://www.w3.org/2000/svg",g):document.createElement(g,m.is&&m),o=null,s=!1}if(null===g)h===m||s&&e.data===m||(e.data=m);else{if(o=o&&u.slice.call(e.childNodes),p=(h=n.props||a).dangerouslySetInnerHTML,f=m.dangerouslySetInnerHTML,!s){if(null!=o)for(h={},_=0;_<e.attributes.length;_++)h[e.attributes[_].name]=e.attributes[_].value;(f||p)&&(f&&(p&&f.__html==p.__html||f.__html===e.innerHTML)||(e.innerHTML=f&&f.__html||""))}if(function(e,t,n,i,r){var o;for(o in n)"children"===o||"key"===o||o in t||T(e,o,null,n[o],i);for(o in t)r&&"function"!=typeof t[o]||"children"===o||"key"===o||"value"===o||"checked"===o||n[o]===t[o]||T(e,o,t[o],n[o],i)}(e,m,h,r,s),f)t.__k=[];else if(v=t.props.children,k(e,Array.isArray(v)?v:[v],t,n,i,r&&"foreignObject"!==g,o,l,e.firstChild,s),null!=o)for(v=o.length;v--;)null!=o[v]&&d(o[v]);s||("value"in m&&void 0!==(v=m.value)&&(v!==e.value||"progress"===g&&!v)&&T(e,"value",v,h.value,!1),"checked"in m&&void 0!==(v=m.checked)&&v!==e.checked&&T(e,"checked",v,h.checked,!1))}return e}function U(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){r.__e(e,n)}}function R(e,t,n){var i,o,l;if(r.unmount&&r.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||U(i,null,t)),n||"function"==typeof e.type||(n=null!=(o=e.__e)),e.__e=e.__d=void 0,null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){r.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(l=0;l<i.length;l++)i[l]&&R(i[l],t,n);null!=o&&d(o)}function P(e,t,n){return this.constructor(e,n)}r={__e:function(e,t){for(var n,i,r;t=t.__;)if((n=t.__c)&&!n.__)try{if((i=n.constructor)&&null!=i.getDerivedStateFromError&&(n.setState(i.getDerivedStateFromError(e)),r=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),r=n.__d),r)return n.__E=n}catch(t){e=t}throw e},__v:0},m.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=p({},this.state),"function"==typeof e&&(e=e(p({},n),this.props)),e&&p(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),y(this))},m.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),y(this))},m.prototype.render=h,o=[],l="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,b.__r=0;var I=function(e,t,n,i){var r;t[0]=0;for(var o=1;o<t.length;o++){var l=t[o++],s=t[o]?(t[0]|=l?1:2,n[t[o++]]):t[++o];3===l?i[0]=s:4===l?i[1]=Object.assign(i[1]||{},s):5===l?(i[1]=i[1]||{})[t[++o]]=s:6===l?i[1][t[++o]]+=s+"":l?(r=e.apply(s,I(e,s,n,["",null])),i.push(r),s[0]?t[0]|=2:(t[o-2]=0,t[o]=r)):i.push(s)}return i},F=new Map;var M={};function A(e,t){for(var n in t)e[n]=t[n];return e}function L(e,t,n){var i,r=/(?:\?([^#]*))?(#.*)?$/,o=e.match(r),l={};if(o&&o[1])for(var s=o[1].split("&"),a=0;a<s.length;a++){var u=s[a].split("=");l[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}e=B(e.replace(r,"")),t=B(t||"");for(var c=Math.max(e.length,t.length),p=0;p<c;p++)if(t[p]&&":"===t[p].charAt(0)){var d=t[p].replace(/(^:|[+*?]+$)/g,""),f=(t[p].match(/[+*?]+$/)||M)[0]||"",_=~f.indexOf("+"),h=~f.indexOf("*"),m=e[p]||"";if(!m&&!h&&(f.indexOf("?")<0||_)){i=!1;break}if(l[d]=decodeURIComponent(m),_||h){l[d]=e.slice(p).map(decodeURIComponent).join("/");break}}else if(t[p]!==e[p]){i=!1;break}return(!0===n.default||!1!==i)&&l}function N(e,t){return e.rank<t.rank?1:e.rank>t.rank?-1:e.index-t.index}function E(e,t){return e.index=t,e.rank=function(e){return e.props.default?0:(t=e.props.path,B(t).map(W).join(""));var t}(e),e.props}function B(e){return e.replace(/(^\/+|\/+$)/g,"").split("/")}function W(e){return":"==e.charAt(0)?1+"*+?".indexOf(e.charAt(e.length-1))||4:5}var H=null,K=[],z=[],J={};function V(){var e;return""+((e=H&&H.location?H.location:H&&H.getCurrentLocation?H.getCurrentLocation():"undefined"!=typeof location?location:J).pathname||"")+(e.search||"")}function G(e,t){return void 0===t&&(t=!1),"string"!=typeof e&&e.url&&(t=e.replace,e=e.url),function(e){for(var t=K.length;t--;)if(K[t].canRoute(e))return!0;return!1}(e)&&function(e,t){void 0===t&&(t="push"),H&&H[t]?H[t](e):"undefined"!=typeof history&&history[t+"State"]&&history[t+"State"](null,null,e)}(e,t?"replace":"push"),q(e)}function q(e){for(var t=!1,n=0;n<K.length;n++)!0===K[n].routeTo(e)&&(t=!0);for(var i=z.length;i--;)z[i](e);return t}function Q(e){if(e&&e.getAttribute){var t=e.getAttribute("href"),n=e.getAttribute("target");if(t&&t.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return G(t)}}function X(e){if(!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||0!==e.button))return Q(e.currentTarget||e.target||this),Y(e)}function Y(e){return e&&(e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.preventDefault()),!1}function Z(e){if(!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||0!==e.button)){var t=e.target;do{if("A"===String(t.nodeName).toUpperCase()&&t.getAttribute("href")){if(t.hasAttribute("native"))return;if(Q(t))return Y(e)}}while(t=t.parentNode)}}var ee=!1;var te=function(n){function i(e){n.call(this,e),e.history&&(H=e.history),this.state={url:e.url||V()},ee||("function"==typeof addEventListener&&(H||addEventListener("popstate",(function(){q(V())})),addEventListener("click",Z)),ee=!0)}return n&&(i.__proto__=n),i.prototype=Object.create(n&&n.prototype),i.prototype.constructor=i,i.prototype.shouldComponentUpdate=function(e){return!0!==e.static||(e.url!==this.props.url||e.onChange!==this.props.onChange)},i.prototype.canRoute=function(t){var n=e(this.props.children);return this.getMatchingChildren(n,t,!1).length>0},i.prototype.routeTo=function(e){this.setState({url:e});var t=this.canRoute(e);return this.updating||this.forceUpdate(),t},i.prototype.componentWillMount=function(){K.push(this),this.updating=!0},i.prototype.componentDidMount=function(){var e=this;H&&(this.unlisten=H.listen((function(t){e.routeTo(""+(t.pathname||"")+(t.search||""))}))),this.updating=!1},i.prototype.componentWillUnmount=function(){"function"==typeof this.unlisten&&this.unlisten(),K.splice(K.indexOf(this),1)},i.prototype.componentWillUpdate=function(){this.updating=!0},i.prototype.componentDidUpdate=function(){this.updating=!1},i.prototype.getMatchingChildren=function(e,n,i){return e.filter(E).sort(N).map((function(e){var r=L(n,e.props.path,e.props);if(r){if(!1!==i){var o={url:n,matches:r};return A(o,r),delete o.ref,delete o.key,t(e,o)}return e}})).filter(Boolean)},i.prototype.render=function(t,n){var i=t.children,r=t.onChange,o=n.url,l=this.getMatchingChildren(e(i),o,!0),s=l[0]||null,a=this.previousUrl;return o!==a&&(this.previousUrl=o,"function"==typeof r&&r({router:this,url:o,previous:a,active:l,current:s})),s},i}(n);function ne({updateTimeframe:e,updateCustomTimeframe:t,clearCustomTimeframe:n,updateResolution:i,filters:r}){return f("div",{class:"grid-lg contain"},[!r.from&&!r.to&&f("div",{class:"w-50-lg"},[f("h4",{},"Timeframe"),f("div",{},[o("today","Today"),o("past-day","Past day"),o("past-week","Past week")]),f("div",{},[o("past-month","Past month"),o("past-6-months","Past 6 months"),o("past-year","Past year")])]),!r.from&&!r.to&&f("div",{class:"w-50-lg"},[f("h4",{},"Resolution"),f("div",{},[["past-year"].includes(r.timeframe)&&l("monthly","Monthly"),["past-week","past-month","past-6-months","past-year"].includes(r.timeframe)&&l("daily","Daily"),["today","past-day","past-week","past-month"].includes(r.timeframe)&&l("hourly","Hourly"),["today","past-day"].includes(r.timeframe)&&l("minutes","Minutes")].filter(Boolean))]),(r.from||r.to)&&f("div",{class:"w-50-lg"},[f("h4",{},"Resolution"),f("div",{},[l("daily","Daily"),l("hourly","Hourly")])]),r.from&&f("div",{},[r.from&&f("span",{class:"filterable static-filter"},"From "),r.from&&f("input",{type:"datetime-local",onChange:e=>{console.log(e.target.value),t(+new Date(e.target.value),+r.to)},value:new Date(+r.from).toISOString().substring(0,16)})]),r.from&&r.to&&f("div",{},[r.to&&f("span",{class:"filterable static-filter"},"To "),r.to&&f("input",{type:"datetime-local",onChange:e=>{console.log(e.target.value),t(+r.from,+new Date(e.target.value))},value:new Date(+r.to).toISOString().substring(0,16)})]),(r.from||r.to)&&f("div",{class:"filterable static-filter",onClick:()=>n()},["Clear [x]"])].filter(Boolean));function o(t,n){return f("span",{onClick:()=>e(t),class:`select-timeframe filterable static-filter ${r.timeframe===t&&"active"}`,name:t,id:t},n)}function l(e,t){return f("span",{onClick:()=>i(e),class:`select-resolution filterable static-filter ${r.resolution===e&&"active"}`,name:e,id:e},t)}}function ie({theme:e,toggleTheme:t=Function.prototype}){return f("div",{class:"theme-toggle",onClick:t},[("dark"===e?"light":"dark")+" theme"])}function re({data:e,filters:t={},updateCustomTimeframe:n}){if(!e)return null;if(!Array.isArray(e.chartData))return null;if(e.chartData.length<2)return f("div",{id:"pageviews-chart",style:{"text-align":"center"}},["Insufficient data to show chart..",f("br",{},[]),"Try to change timeframe or resolution."]);const i=Math.max(...e.chartData.map((e=>e[1])));return f("div",{id:"pageviews-chart"},[f("table",{class:"charts-css column show-labels show-primary-axis"},[f("thead",{},[f("tr",{},[f("th",{scope:"col"},"Date"),f("th",{scope:"col"},"Pageviews")])]),f("tbody",{},e.chartData.map(((o,l)=>f("tr",{key:o[0],onClick:()=>n(+new Date(o[0]))},[f("td",{style:{"--start":0===l?0:e.chartData[l-1][1]/i,"--size":o[1]/i}},[e.chartData.length<50&&f("span",{class:"data"},o[1]),f("span",{class:"tooltip"},[r(o[0],t.resolution),f("br",{},null),`${o[1]} pageviews`])].filter(Boolean))]))))])]);function r(e,t){return"daily"===t||"monthly"===t?new Date(e).toLocaleDateString():new Date(e).toLocaleString()}}function oe({data:e,filters:t={},toggleFilter:n}){if(!e)return null;if(!Number.isFinite(e.visitorsCount))return null;if(!Number.isFinite(e.pageviewsCount))return null;let i=e.live||{};return Object.keys(t).length>2&&(i=Object.keys(i).reduce(((e,n)=>{const r=Object.keys(t).filter((e=>["p","r","v"].includes(e)));return r.every((e=>i[n].pageview[e]===t[e]))?Object.assign(e,{[n]:i[n]}):e}),{})),f("div",{},[f("div",{class:"grid contain text-lg"},[f("div",{class:"w-50"},[f("h2",{},"Visitors"),f("div",{id:"visitors-count"},e.visitorsCount)]),f("div",{class:"w-50"},[f("h2",{},"Pageviews"),f("div",{id:"pageviews-count"},e.pageviewsCount)]),f("div",{class:"w-50"},[f("h2",{},"Bounce rate"),f("div",{id:"bounce-rate"},(e.visitorsCount/e.pageviewsCount*100).toFixed(0)+"%")]),f("div",{class:"w-50"},[f("h2",{},"Live"),f("div",{id:"live"},Object.keys(i).length)])]),f("div",{class:"contain",id:"live-pages"},[Object.keys(i).length>0&&f("h2",{},["Live pages ",f("span",{class:"live-dot"},[])]),f("ul",{},Object.keys(i).reduce(((e,t)=>{const n=e.find((({p:e})=>e===i[t].pageview.p));return n?(n.c++,e):e.concat([{p:i[t].pageview.p,c:1}])}),[]).sort(((e,t)=>e.c-t.c)).map((({p:e,c:i})=>f("li",{class:`filterable ${t.p===e&&"active"}`,onClick:()=>n("p",e),key:e},`${i} · ${e}`))))].filter(Boolean)),f("div",{class:"contain",id:"live-referrers"},[Object.keys(i).length>0&&f("h2",{},["Live referrers ",f("span",{class:"live-dot"},[])]),f("ul",{},Object.keys(i).reduce(((e,t)=>{const n=e.find((({r:e})=>e===i[t].pageview.r));return n?(n.c++,e):e.concat([{r:i[t].pageview.r,c:1}])}),[]).sort(((e,t)=>e.c-t.c)).map((({r:e,c:i})=>f("li",{class:`filterable ${t.r===e&&"active"}`,onClick:()=>n("r",e),key:e},`${i} · ${(e||"").replace("https://","").replace("http://","")||"none"}`))))].filter(Boolean))].filter(Boolean))}function le({data:e,loading:t,filters:n={},toggleFilter:i}){if(!e)return null;const{referrers:r=[]}=e,{pages:o=[]}=e,l=Math.max(...r.map((e=>e.views))),s=Math.max(...o.map((e=>e.views)));return f("div",{},[f("div",{class:`grid-lg contain ${t&&"loading"}`},[f("div",{class:"w-50-lg",id:"referrers"},[f("h2",{},"Top Referrers"),f("ul",{id:"top-referrers"},r.map((e=>{const t=`https://icons.duckduckgo.com/ip3/${function(e){if(!e)return"/";const t=document.createElement("a");return t.href=e,t.hostname}(e.r)}.ico`;return f("li",{key:e.r,class:`filterable ${n.r===e.r&&"active"}`,style:{"--data-percentage":100-80*e.views/l+"%"},onClick:()=>i("r",e.r)},[f("div",{},[f("b",{class:"views"},e.views),f("img",{loading:"lazy",class:"favicon",src:t},[]),e.r.replace("https://","").replace("http://","")||"none"])])})))]),f("div",{class:"w-50-lg",id:"pages"},[f("h2",{},"Top Pages"),f("ul",{id:"top-pages"},o.map((e=>f("li",{key:e.p,onClick:()=>i("p",e.p),class:`filterable ${n.p===e.p&&"active"}`,style:{"--data-percentage":100-80*e.views/s+"%"}},[f("b",{class:"views"},e.views),e.p]))))])])])}function se({data:e,filters:t={},toggleFilter:n}){return e&&Array.isArray(e.data)?f("div",{class:"contain"},[f("ul",{},e.data.map(((e,i)=>f("li",{class:"pageview",key:e.d},[f("div",{class:`filterable ${t.v===e.v&&"active"}`,onClick:()=>n("v",e.v)},[f("time",{},e.d.substring(0,19)),e.v," ",f("span",{style:{"background-color":ue(e.v)},class:"visitor dot"},[])]),f("div",{class:`filterable ${t.p===e.p&&"active"}`,onClick:()=>n("p",e.p)},[f("b",{},e.p)]),e.r&&f("div",{class:`filterable ${t.r===e.r&&"active"}`,onClick:()=>n("r",e.r)},["from ",f("img",{class:"favicon",src:`https://icons.duckduckgo.com/ip3/${ae(e.r)}.ico`}),e.r.replace("https://","").replace("http://","")])].filter(Boolean)))))]):null}function ae(e){if(!e)return"/";const t=document.createElement("a");return t.href=e,t.hostname}function ue(e){return"#"+function(e){const t=(16777215&e).toString(16).toUpperCase();return"00000".substring(0,6-t.length)+t}(function(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}(e))}te.subscribers=z,te.getCurrentUrl=V,te.route=G,te.Router=te,te.Route=function(e){return i(e.component,e)},te.Link=function(e){return i("a",A({onClick:X},e))},te.exec=L;class ce extends m{render({data:e,filters:t,loading:n,theme:i,updateResolution:r,updateTimeframe:o,updateCustomTimeframe:l,clearCustomTimeframe:s,toggleFilter:a,toggleTheme:u}={}){return 0===Object.keys(e).length?null:f("div",{class:`${n&&"loading"}`},[f(ie,{theme:i,toggleTheme:u},[]),f(ne,{updateResolution:r,updateTimeframe:o,updateCustomTimeframe:l,clearCustomTimeframe:s,filters:t},[]),f(re,{filters:t,data:e,updateCustomTimeframe:l},[]),f(oe,{toggleFilter:a,filters:t,data:e},[]),f(le,{data:e,filters:t,toggleFilter:a},[]),f(se,{data:e,filters:t,toggleFilter:a},[])].filter(Boolean))}}const pe={data:{},mounted:!1,loading:!1,filters:{timeframe:"today",resolution:"hourly"},theme:"light"};localStorage.getItem("state")&&Object.assign(pe,JSON.parse(localStorage.getItem("state")));const de=function(e){var t=F.get(this);return t||(t=new Map,F.set(this,t)),(t=I(this,t.get(e)||(t.set(e,t=function(e){for(var t,n,i=1,r="",o="",l=[0],s=function(e){1===i&&(e||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?l.push(0,e,r):3===i&&(e||r)?(l.push(3,e,r),i=2):2===i&&"..."===r&&e?l.push(4,e,0):2===i&&r&&!e?l.push(5,0,!0,r):i>=5&&((r||!e&&5===i)&&(l.push(i,0,r,n),i=6),e&&(l.push(i,e,0,n),i=6)),r=""},a=0;a<e.length;a++){a&&(1===i&&s(),s(a));for(var u=0;u<e[a].length;u++)t=e[a][u],1===i?"<"===t?(s(),l=[l],i=3):r+=t:4===i?"--"===r&&">"===t?(i=1,r=""):r=t+r[0]:o?t===o?o="":r+=t:'"'===t||"'"===t?o=t:">"===t?(s(),i=1):i&&("="===t?(i=5,n=r,r=""):"/"===t&&(i<5||">"===e[a][u+1])?(s(),3===i&&(l=l[0]),i=l,(l=l[0]).push(2,0,i),i=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(s(),i=2):r+=t),3===i&&"!--"===r&&(i=4,l=l[0])}return s(),l}(e)),t),arguments,[])).length>1?t:t[0]}.bind(f);!function(e,t,n){var i,o,l;r.__&&r.__(e,t),o=(i="function"==typeof n)?null:n&&n.__k||t.__k,l=[],j(t,e=(!i&&n||t).__k=f(h,null,[e]),o||a,a,void 0!==t.ownerSVGElement,!i&&n?[n]:o?null:t.firstChild?u.slice.call(t.childNodes):null,l,!i&&n?n:o?o.__e:t.firstChild,i),$(l,e)}(de`<${class extends m{state=pe;componentDidMount(){if(window.location.search){const e=window.location.search.substring(1).split("&").map((e=>e.split("="))).reduce(((e,t)=>Object.assign(e,{[t[0]]:decodeURIComponent(t[1])})),{});this.setState({mounted:!0,filters:Object.assign({},this.state.filters,e)},(()=>this.getData()))}else this.setState({mounted:!0},(()=>this.getData()));setInterval((()=>this.getData()),6e4);new window.EventSource("/").onmessage=e=>{if(!e||!e.data)return console.error("skipping empty message");try{const t=JSON.parse(e.data,{});this.setState({data:Object.assign({},this.state.data,{live:t})})}catch(e){console.error("sse parse error",e)}}}async handleRoute(e){if(this.state.mounted)if(window.location.search){const e=window.location.search.substring(1).split("&").map((e=>e.split("="))).reduce(((e,t)=>Object.assign(e,{[t[0]]:decodeURIComponent(t[1])})),{});this.setState({filters:Object.assign({},this.state.filters,e)},(()=>this.getData()))}else this.getData()}async getData(){if(this.state.loading)return;this.setState({loading:!0});let e="";Object.keys(this.state.filters).length>0&&(e="?"+Object.keys(this.state.filters).reduce(((e,t)=>e.concat([`${t}=${encodeURIComponent(this.state.filters[t])}`])),[]).join("&"));const t=/(localhost|127\.0\.0\.1|0\.0\.0\.0)/.test(window.location.origin)?"http://127.0.0.1:8080":window.location.origin,n=await window.fetch(t+"/api/"+e),i=await n.json();this.setState({data:i,loading:!1},(()=>localStorage.setItem("state",JSON.stringify(this.state))))}clearCustomTimeframe(){const e=Object.assign({},this.state.filters,{timeframe:"past-day"});delete e.from,delete e.to,this.setState({filters:e},(()=>G("?"+Object.keys(e).reduce(((t,n)=>t.concat([`${n}=${encodeURIComponent(e[n])}`])),[]).join("&"))))}updateCustomTimeframe(e,t=Date.now()){if(!Number.isFinite(+new Date(e)))return;if(!Number.isFinite(+new Date(t)))return;const n=Object.assign({},this.state.filters,{from:e,to:t});delete n.timeframe,this.setState({filters:n},(()=>G("?"+Object.keys(n).reduce(((e,t)=>e.concat([`${t}=${encodeURIComponent(n[t])}`])),[]).join("&"))))}updateTimeframe(e){const t=Object.assign({},this.state.filters,{timeframe:e});["today","past-day"].includes(e)&&["monthly","daily"].includes(t.resolution)&&(t.resolution="hourly"),["past-week"].includes(e)&&["minutes","monthly"].includes(t.resolution)&&(t.resolution="daily"),["past-month"].includes(e)&&["minutes","monthly"].includes(t.resolution)&&(t.resolution="daily"),["past-6-months"].includes(e)&&["minutes","hourly"].includes(t.resolution)&&(t.resolution="daily"),["past-year"].includes(e)&&["minutes","hourly","daily"].includes(t.resolution)&&(t.resolution="monthly"),this.setState({filters:t},(()=>G("?"+Object.keys(t).reduce(((e,n)=>e.concat([`${n}=${encodeURIComponent(t[n])}`])),[]).join("&"))))}updateResolution(e){const t=Object.assign({},this.state.filters,{resolution:e});this.setState({filters:t},(()=>G("?"+Object.keys(t).reduce(((e,n)=>e.concat([`${n}=${encodeURIComponent(t[n])}`])),[]).join("&"))))}toggleFilter(e,t){const n=Object.assign({},this.state.filters);n[e]===t?delete n[e]:n[e]=t,this.setState({filters:n},(()=>G("?"+Object.keys(n).reduce(((e,t)=>e.concat([`${t}=${encodeURIComponent(n[t])}`])),[]).join("&"))))}toggleTheme(){this.setState({theme:"dark"===this.state.theme?"light":"dark"})}render(){return f("div",{id:"app",class:`theme-${this.state.theme}`},[f(te,{onChange:this.handleRoute.bind(this)},[f(ce,{data:this.state.data,filters:this.state.filters,loading:this.state.loading,theme:this.state.theme,updateResolution:this.updateResolution.bind(this),updateTimeframe:this.updateTimeframe.bind(this),updateCustomTimeframe:this.updateCustomTimeframe.bind(this),clearCustomTimeframe:this.clearCustomTimeframe.bind(this),toggleFilter:this.toggleFilter.bind(this),toggleTheme:this.toggleTheme.bind(this),path:"/"},[])])])}}}/>`,document.body);
//# sourceMappingURL=build.min.js.map
